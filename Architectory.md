# Архитектура Mini Miro Board

## Обзор проекта
Минималистичное офлайн-приложение на Python/Tkinter, повторяющее ключевой функционал доски Miro: карточки со связями, рамки, мини-карта, история действий и сохранение/загрузка в JSON. Запуск осуществляется через `app.py`, который создаёт и запускает экземпляр `BoardApp` из пакета `src`.

## Файловая структура
- `app.py` — точка входа. Импортирует `BoardApp` из `src.main` и вызывает `run()`, предоставляя графический интерфейс доски.
- `requirements.txt` — внешняя зависимость: `pillow>=10.0.0` для экспорта в PNG и работы с изображениями.
- `_mini_miro_config.json` — пользовательские настройки (тема, цвета текста для тем и флаг отображения сетки).
- `_mini_miro_autosave.json` — последнее автосохранение состояния доски (карточки, рамки, связи, вложения изображений).
- `README.md` — подробное описание пользовательских возможностей, горячих клавиш и сценариев работы.
- `LICENSE`, `Architectory.md`, вспомогательные файлы (`ё1.json`) — служебные материалы и документация.

> Примечание: исходный код пакета `src` (описанный в `README.md` и импортируемый из `app.py`) в текущей версии репозитория отсутствует. Архитектура ниже опирается на интерфейсы, подразумеваемые точкой входа и структурой данных автосохранения.

## Логические компоненты
### Приложение (`BoardApp`)
- Инициализируется в `app.py` и должно обеспечивать графический интерфейс на базе Tkinter.
- Ожидаемые обязанности (согласно README): управление карточками, связями, рамками, историей undo/redo, навигацией (зум, панорамирование), настройками темы и сетки, импорт/экспорт в PNG/JSON, а также работу с вложениями изображений.

### Модель данных доски
- **Карточки**: содержат позицию (`x`, `y`), размеры, цвет, текст и массив `attachments`.
- **Вложения**: для каждой карточки включают идентификатор, имя файла, источник (`file` или `clipboard`), MIME-тип, габариты изображения, смещения, масштаб предпросмотра и путь хранения бинарных данных. Пример набора ключей приведён в автосохранении.
- **Рамки и связи**: ожидаются в автосохранении рядом с карточками; используются для группировки и визуальных связей между карточками.
- **Метаданные состояния**: `schema_version` фиксирует версию формата.

## Потоки данных
1. **Запуск**: `python app.py` создаёт `BoardApp`, который загружает пользовательские настройки из `_mini_miro_config.json` и, при наличии, предлагает восстановить состояние из `_mini_miro_autosave.json`.
2. **Работа с доской**: пользователь взаимодействует через GUI; изменения приводят к обновлению внутренней модели (карточки, связи, рамки) и истории действий для undo/redo.
3. **Сохранение**: состояние сериализуется в JSON-формат автосохранения; вложения сохраняются отдельными файлами, а JSON хранит относительные пути и метаданные.
4. **Экспорт**: при наличии Pillow может экспортировать текущее состояние в PNG.

## Данные автосохранения
- `schema_version`: версия формата (текущее значение — `4`).
- `cards`: список карточек с координатами, размерами, цветом, текстом и вложениями.
- `attachments`: внутри каждой карточки содержат идентификатор, имя, источник, MIME-тип, размеры, смещения, масштаб предпросмотра, путь хранения и поле `data_base64` (если бинарные данные встраиваются во временный файл автосохранения).
- `frames` и `connections`: ожидаемые разделы для рамок и связей, описывающие группировку карточек и стрелочные связи между ними.

## Предполагаемая структура пакета `src`
На основании `README.md` и строки импорта в `app.py` предполагается следующий модульный разрез (файлы отсутствуют, но интерфейсы ожидаются):
- `src/main.py`: инициализация Tkinter-приложения, настройка меню/тулбара/мини-карты, обработка событий и запуск цикла приложения.
- `src/board_model.py`: модели данных для карточек, рамок, связей, вложений и сериализации в/из JSON.
- `src/history.py`: стек команд undo/redo, снапшоты состояния и применение изменений.

Эта структура соответствует возможностям, перечисленным в README, и используется точкой входа как контракт для реализации интерфейса доски.
